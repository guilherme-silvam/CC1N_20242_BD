-- FASE 1: CRIAR O BANCO DE DADOS (SCHEMA OU DATABASE):
CREATE SCHEMA IF NOT EXISTS EC1_CC1N;

-- FASE 2: SELECIONAR O NOVO SCHEMA OU DATABASE PARA USO:
USE EC1_CC1N;

-- FASE 3: CRIANDO AS TABELAS SEM CHAVES ESTRANGEIRAS

-- CRIANDO A TABELA FORNECEDORES
CREATE TABLE IF NOT EXISTS FORNECEDORES(
    FORNEC_COD INT PRIMARY KEY,
    FORNEC_NOME VARCHAR(45) NOT NULL,
    FORNEC_RUA VARCHAR(45) NOT NULL,
    FORNEC_NUMRUA INT,
    FORNEC_BAIRRO VARCHAR(45) NOT NULL,
    FORNEC_CIDADE VARCHAR(45) NOT NULL,
    FORNEC_ESTADO VARCHAR(45) NOT NULL,
    FORNEC_PAIS VARCHAR(30) NOT NULL,
    FORNEC_CODPOSTAL VARCHAR(10) NOT NULL,
    FORNEC_TELEFONE VARCHAR(15) NOT NULL,
    FORNEC_CONTATO TEXT NOT NULL
);

-- CRIANDO A TABELA FILIAIS
CREATE TABLE IF NOT EXISTS FILIAIS(
    FILIAL_COD INT PRIMARY KEY,
    FILIAL_NOME VARCHAR(45) NOT NULL,
    FILIAL_RUA VARCHAR(100) NOT NULL,
    FILIAL_NUMRUA INT,
    FILIAL_BAIRRO VARCHAR(50) NOT NULL,
    FILIAL_CIDADE VARCHAR(50) NOT NULL,
    FILIAL_ESTADO VARCHAR(50) NOT NULL,
    FILIAL_PAIS VARCHAR(50) NOT NULL,
    FILIAL_CODPOSTAL VARCHAR(10) NOT NULL,
    FILIAL_CAPACIDADE TEXT NOT NULL
);

-- CRIANDO A TABELA PRODUTOS
CREATE TABLE IF NOT EXISTS PRODUTOS(
    PROD_COD INT PRIMARY KEY,
    PROD_NOME VARCHAR(50) NOT NULL,
    PROD_DESCRICAO TEXT NOT NULL,
    PROD_ESPECTEC TEXT NOT NULL,
    PROD_QUANT DECIMAL(10,3) NOT NULL,
    PROD_PRECOUNIT DECIMAL(10,2) NOT NULL,
    PROD_UNIDMEDIDA VARCHAR(10) NOT NULL,
    PROD_ESTOQ_MIN DECIMAL(10,3) NOT NULL
);

-- FASE 4: CRIAR AS TABELAS COM DEPENDÊNCIA DE CHAVE ESTRANGEIRA

-- CRIANDO A TABELA PEDIDOS
CREATE TABLE IF NOT EXISTS PEDIDOS(
    PED_CODIGO INT PRIMARY KEY,
    PED_DATA DATE NOT NULL,
    PED_HORA TIME NOT NULL,
    PED_PREVISAO DATE NOT NULL,
    PED_STATUS ENUM('PENDENTE','CONCLUÍDO','EM ESPERA'),
    PED_FORNECEDOR INT NOT NULL,
    CONSTRAINT FK_FORNECEDOR FOREIGN KEY (PED_FORNECEDOR)
    REFERENCES FORNECEDORES(FORNEC_COD)
);

-- CRIANDO A TABELA RECEBIMENTOS
CREATE TABLE IF NOT EXISTS RECEBIMENTOS(
    RECEB_DATA DATE NOT NULL,
    RECEB_HORA TIME NOT NULL,
    RECEB_QUANT_PROD DECIMAL(10,3),
    RECEB_CONDICAO TEXT NOT NULL,
    RECEB_PEDIDOS INT PRIMARY KEY,
    CONSTRAINT FK_PEDIDOS FOREIGN KEY(RECEB_PEDIDOS)
    REFERENCES PEDIDOS(PED_CODIGO)
);

-- CRIANDO A TABELA PEDIDOS_PRODUTOS
CREATE TABLE IF NOT EXISTS PEDIDOS_PRODUTOS(
    PDPR_PEDIDOS INT,
    PDPR_PRODUTOS INT,
    PRIMARY KEY(PDPR_PEDIDOS,PDPR_PRODUTOS),
    PDPR_QUANT DECIMAL(10,3) NOT NULL,
    CONSTRAINT PDPR_FK_PEDIDOS FOREIGN KEY(PDPR_PEDIDOS)
    REFERENCES PEDIDOS(PED_CODIGO),
    CONSTRAINT PDPR_FK_PRODUTOS FOREIGN KEY(PDPR_PRODUTOS)
    REFERENCES PRODUTOS(PROD_COD)
);

-- CRIANDO A TABELA FILIAIS_PRODUTOS
CREATE TABLE IF NOT EXISTS FILIAIS_PRODUTOS(
    FLPR_FILIAL INT,
    FLPR_PRODUTOS INT,
    PRIMARY KEY(FLPR_FILIAL,FLPR_PRODUTOS),
    FLPR_QUANT DECIMAL(10,3) NOT NULL,
    CONSTRAINT FLPR_FK_FILIAIS FOREIGN KEY(FLPR_FILIAL)
    REFERENCES FILIAIS(FILIAL_COD),
    CONSTRAINT FLPR_FK_PRODUTOS FOREIGN KEY(FLPR_PRODUTOS)
    REFERENCES PRODUTOS(PROD_COD)
);

-- FASE 5: INSERINDO DADOS

-- Inserções na tabela FORNECEDORES
INSERT INTO FORNECEDORES (FORNEC_COD, FORNEC_NOME, FORNEC_RUA, FORNEC_NUMRUA, FORNEC_BAIRRO, FORNEC_CIDADE, FORNEC_ESTADO, FORNEC_PAIS, FORNEC_CODPOSTAL, FORNEC_TELEFONE, FORNEC_CONTATO) VALUES
(1, 'Fornecedor A', 'Rua A', 100, 'Bairro A', 'Cidade A', 'Estado A', 'Brasil', '12345-678', '123456789', 'Contato A'),
(2, 'Fornecedor B', 'Rua B', 200, 'Bairro B', 'Cidade B', 'Estado B', 'Brasil', '23456-789', '987654321', 'Contato B'),
(3, 'Fornecedor C', 'Rua C', 300, 'Bairro C', 'Cidade C', 'Estado C', 'Brasil', '34567-890', '456789123', 'Contato C'),
(4, 'Fornecedor D', 'Rua D', 400, 'Bairro D', 'Cidade D', 'Estado D', 'Brasil', '45678-901', '321654987', 'Contato D'),
(5, 'Fornecedor E', 'Rua E', 500, 'Bairro E', 'Cidade E', 'Estado E', 'Brasil', '56789-012', '789123456', 'Contato E');

-- Inserções na tabela FILIAIS
INSERT INTO FILIAIS (FILIAL_COD, FILIAL_NOME, FILIAL_RUA, FILIAL_NUMRUA, FILIAL_BAIRRO, FILIAL_CIDADE, FILIAL_ESTADO, FILIAL_PAIS, FILIAL_CODPOSTAL, FILIAL_CAPACIDADE) VALUES
(1, 'Filial A', 'Rua Filial A', 101, 'Bairro A', 'Cidade A', 'Estado A', 'Brasil', '12345-678', '50'),
(2, 'Filial B', 'Rua Filial B', 202, 'Bairro B', 'Cidade B', 'Estado B', 'Brasil', '23456-789', '100'),
(3, 'Filial C', 'Rua Filial C', 303, 'Bairro C', 'Cidade C', 'Estado C', 'Brasil', '34567-890', '150'),
(4, 'Filial D', 'Rua Filial D', 404, 'Bairro D', 'Cidade D', 'Estado D', 'Brasil', '45678-901', '200'),
(5, 'Filial E', 'Rua Filial E', 505, 'Bairro E', 'Cidade E', 'Estado E', 'Brasil', '56789-012', '250');

-- Inserções na tabela PRODUTOS
INSERT INTO PRODUTOS (PROD_COD, PROD_NOME, PROD_DESCRICAO, PROD_ESPECTEC, PROD_QUANT, PROD_PRECOUNIT, PROD_UNIDMEDIDA, PROD_ESTOQ_MIN) VALUES
(1, 'Produto A', 'Descrição A', 'Especificação A', 10.000, 50.00, 'UN', 5.000),
(2, 'Produto B', 'Descrição B', 'Especificação B', 20.000, 100.00, 'UN', 10.000),
(3, 'Produto C', 'Descrição C', 'Especificação C', 15.000, 75.00, 'UN', 7.500),
(4, 'Produto D', 'Descrição D', 'Especificação D', 5.000, 25.00, 'UN', 2.500),
(5, 'Produto E', 'Descrição E', 'Especificação E', 8.000, 40.00, 'UN', 4.000);

-- Inserções na tabela PEDIDOS
INSERT INTO PEDIDOS (PED_CODIGO, PED_DATA, PED_HORA, PED_PREVISAO, PED_STATUS, PED_FORNECEDOR) VALUES
(1, '2024-11-01', '10:00:00', '2024-11-05', 'PENDENTE', 1),
(2, '2024-11-02', '11:00:00', '2024-11-06', 'CONCLUÍDO', 2),
(3, '2024-11-03', '12:00:00', '2024-11-07', 'EM ESPERA', 3),
(4, '2024-11-04', '13:00:00', '2024-11-08', 'PENDENTE', 4),
(5, '2024-11-05', '14:00:00', '2024-11-09', 'CONCLUÍDO', 5);

-- Inserções na tabela RECEBIMENTOS
INSERT INTO RECEBIMENTOS (RECEB_DATA, RECEB_HORA, RECEB_QUANT_PROD, RECEB_CONDICAO, RECEB_PEDIDOS) VALUES
('2024-11-01', '10:30:00', 10.000, 'Recebido em bom estado', 1),
('2024-11-02', '11:30:00', 5.000, 'Recebido com avarias', 2),
('2024-11-03', '12:30:00', 15.000, 'Recebido em bom estado', 3),
('2024-11-04', '13:30:00', 8.000, 'Recebido em bom estado', 4),
('2024-11-05', '14:30:00', 12.000, 'Recebido em bom estado', 5);

-- Inserções na tabela PEDIDOS_PRODUTOS
INSERT INTO PEDIDOS_PRODUTOS (PDPR_PEDIDOS, PDPR_PRODUTOS, PDPR_QUANT) VALUES
(1, 1, 10.000),
(1, 2, 5.000),
(2, 2, 3.000),
(2, 3, 7.000),
(3, 3, 2.000);

-- Inserções na tabela FILIAIS_PRODUTOS
INSERT INTO FILIAIS_PRODUTOS (FLPR_FILIAL, FLPR_PRODUTOS, FLPR_QUANT) VALUES
(1, 1, 10.000),
(1, 2, 20.000),
(2, 2, 15.000),
(2, 3, 30.000),
(3, 3, 5.000);

-- FASE 6: ATUALIZANDO DADOS

-- Atualizações na tabela FORNECEDORES
UPDATE FORNECEDORES 
SET FORNEC_NOME = 'Fornecedor A Modificado' 
WHERE FORNEC_COD = 1;

UPDATE FORNECEDORES 
SET FORNEC_TELEFONE = '111222333' 
WHERE FORNEC_COD = 2;

-- Atualizações na tabela FILIAIS
UPDATE FILIAIS 
SET FILIAL_NOME = 'Filial A Modificada' 
WHERE FILIAL_COD = 1;

UPDATE FILIAIS 
SET FILIAL_CAPACIDADE = '80' 
WHERE FILIAL_COD = 2;

-- Atualizações na tabela PRODUTOS
UPDATE PRODUTOS 
SET PROD_PRECOUNIT = 55.00 
WHERE PROD_COD = 1;

UPDATE PRODUTOS 
SET PROD_QUANT = 18.000 
WHERE PROD_COD = 3;

-- Atualizações na tabela PEDIDOS
UPDATE PEDIDOS 
SET PED_STATUS = 'PENDENTE' 
WHERE PED_CODIGO = 1;

UPDATE PEDIDOS 
SET PED_DATA = '2024-11-15' 
WHERE PED_CODIGO = 2;

-- Atualizações na tabela RECEBIMENTOS
UPDATE RECEBIMENTOS 
SET RECEB_CONDICAO = 'Recebido em perfeito estado' 
WHERE RECEB_PEDIDOS = 1;

UPDATE RECEBIMENTOS 
SET RECEB_QUANT_PROD = 8.000 
WHERE RECEB_PEDIDOS = 2;

-- Atualizações na tabela PEDIDOS_PRODUTOS
UPDATE PEDIDOS_PRODUTOS 
SET PDPR_QUANT = 12.000 
WHERE PDPR_PEDIDOS = 1 AND PDPR_PRODUTOS = 1;

UPDATE PEDIDOS_PRODUTOS 
SET PDPR_QUANT = 10.000 
WHERE PDPR_PEDIDOS = 2 AND PDPR_PRODUTOS = 3;

-- Atualizações na tabela FILIAIS_PRODUTOS
UPDATE FILIAIS_PRODUTOS 
SET FLPR_QUANT = 12.000 
WHERE FLPR_FILIAL = 1 AND FLPR_PRODUTOS = 1;

UPDATE FILIAIS_PRODUTOS 
SET FLPR_QUANT = 18.000 
WHERE FLPR_FILIAL = 2 AND FLPR_PRODUTOS = 3;

-- FASE 7: EXCLUINDO DADOS

-- Exclusões na tabela FORNECEDORES
DELETE FROM FORNECEDORES 
WHERE FORNEC_COD = 3;

DELETE FROM FORNECEDORES 
WHERE FORNEC_COD = 4;

-- Exclusões na tabela FILIAIS
DELETE FROM FILIAIS 
WHERE FILIAL_COD = 3;

DELETE FROM FILIAIS 
WHERE FILIAL_COD = 4;

-- Exclusões na tabela PRODUTOS
DELETE FROM PRODUTOS 
WHERE PROD_COD = 4;

DELETE FROM PRODUTOS 
WHERE PROD_COD = 5;

-- Exclusões na tabela PEDIDOS
DELETE FROM PEDIDOS 
WHERE PED_CODIGO = 3;

DELETE FROM PEDIDOS 
WHERE PED_CODIGO = 4;

-- Exclusões na tabela RECEBIMENTOS
DELETE FROM RECEBIMENTOS 
WHERE RECEB_PEDIDOS = 2;

DELETE FROM RECEBIMENTOS 
WHERE RECEB_PEDIDOS = 3;

-- Exclusões na tabela PEDIDOS_PRODUTOS
DELETE FROM PEDIDOS_PRODUTOS 
WHERE PDPR_PEDIDOS = 1 AND PDPR_PRODUTOS = 1;

DELETE FROM PEDIDOS_PRODUTOS 
WHERE PDPR_PEDIDOS = 2 AND PDPR_PRODUTOS = 2;

-- Exclusões na tabela FILIAIS_PRODUTOS
DELETE FROM FILIAIS_PRODUTOS 
WHERE FLPR_FILIAL = 1 AND FLPR_PRODUTOS = 1;

DELETE FROM FILIAIS_PRODUTOS 
WHERE FLPR_FILIAL = 2 AND FLPR_PRODUTOS = 2;

